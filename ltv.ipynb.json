{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 18,
   "metadata": {},
   "outputs": [],
   "source": [
    "#import modules\n",
    "import pandas as pd # for dataframes\n",
    "import matplotlib.pyplot as plt # for plotting graphs\n",
    "import seaborn as sns # for plotting graphs\n",
    "import datetime as dt\n",
    "import numpy as np"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "metadata": {},
   "outputs": [],
   "source": [
    "data = pd.read_excel(\"retaildata.xls\")\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>InvoiceNo</th>\n",
       "      <th>StockCode</th>\n",
       "      <th>Description</th>\n",
       "      <th>Quantity</th>\n",
       "      <th>InvoiceDate</th>\n",
       "      <th>UnitPrice</th>\n",
       "      <th>CustomerID</th>\n",
       "      <th>Country</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>536365</td>\n",
       "      <td>85123A</td>\n",
       "      <td>WHITE HANGING HEART T-LIGHT HOLDER</td>\n",
       "      <td>6</td>\n",
       "      <td>2010-12-01 08:26:00</td>\n",
       "      <td>2.55</td>\n",
       "      <td>17850.0</td>\n",
       "      <td>United Kingdom</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>536365</td>\n",
       "      <td>71053</td>\n",
       "      <td>WHITE METAL LANTERN</td>\n",
       "      <td>6</td>\n",
       "      <td>2010-12-01 08:26:00</td>\n",
       "      <td>3.39</td>\n",
       "      <td>17850.0</td>\n",
       "      <td>United Kingdom</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>536365</td>\n",
       "      <td>84406B</td>\n",
       "      <td>CREAM CUPID HEARTS COAT HANGER</td>\n",
       "      <td>8</td>\n",
       "      <td>2010-12-01 08:26:00</td>\n",
       "      <td>2.75</td>\n",
       "      <td>17850.0</td>\n",
       "      <td>United Kingdom</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>536365</td>\n",
       "      <td>84029G</td>\n",
       "      <td>KNITTED UNION FLAG HOT WATER BOTTLE</td>\n",
       "      <td>6</td>\n",
       "      <td>2010-12-01 08:26:00</td>\n",
       "      <td>3.39</td>\n",
       "      <td>17850.0</td>\n",
       "      <td>United Kingdom</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>536365</td>\n",
       "      <td>84029E</td>\n",
       "      <td>RED WOOLLY HOTTIE WHITE HEART.</td>\n",
       "      <td>6</td>\n",
       "      <td>2010-12-01 08:26:00</td>\n",
       "      <td>3.39</td>\n",
       "      <td>17850.0</td>\n",
       "      <td>United Kingdom</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "  InvoiceNo StockCode                          Description  Quantity  \\\n",
       "0    536365    85123A   WHITE HANGING HEART T-LIGHT HOLDER         6   \n",
       "1    536365     71053                  WHITE METAL LANTERN         6   \n",
       "2    536365    84406B       CREAM CUPID HEARTS COAT HANGER         8   \n",
       "3    536365    84029G  KNITTED UNION FLAG HOT WATER BOTTLE         6   \n",
       "4    536365    84029E       RED WOOLLY HOTTIE WHITE HEART.         6   \n",
       "\n",
       "          InvoiceDate  UnitPrice  CustomerID         Country  \n",
       "0 2010-12-01 08:26:00       2.55     17850.0  United Kingdom  \n",
       "1 2010-12-01 08:26:00       3.39     17850.0  United Kingdom  \n",
       "2 2010-12-01 08:26:00       2.75     17850.0  United Kingdom  \n",
       "3 2010-12-01 08:26:00       3.39     17850.0  United Kingdom  \n",
       "4 2010-12-01 08:26:00       3.39     17850.0  United Kingdom  "
      ]
     },
     "execution_count": 21,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "data.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Removing Duplicates that might hinder our learning process. "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 22,
   "metadata": {},
   "outputs": [],
   "source": [
    "filtered_data=data[['Country','CustomerID']].drop_duplicates()\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>InvoiceNo</th>\n",
       "      <th>StockCode</th>\n",
       "      <th>Description</th>\n",
       "      <th>Quantity</th>\n",
       "      <th>InvoiceDate</th>\n",
       "      <th>UnitPrice</th>\n",
       "      <th>CustomerID</th>\n",
       "      <th>Country</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>536365</td>\n",
       "      <td>85123A</td>\n",
       "      <td>WHITE HANGING HEART T-LIGHT HOLDER</td>\n",
       "      <td>6</td>\n",
       "      <td>2010-12-01 08:26:00</td>\n",
       "      <td>2.55</td>\n",
       "      <td>17850.0</td>\n",
       "      <td>United Kingdom</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>536365</td>\n",
       "      <td>71053</td>\n",
       "      <td>WHITE METAL LANTERN</td>\n",
       "      <td>6</td>\n",
       "      <td>2010-12-01 08:26:00</td>\n",
       "      <td>3.39</td>\n",
       "      <td>17850.0</td>\n",
       "      <td>United Kingdom</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>536365</td>\n",
       "      <td>84406B</td>\n",
       "      <td>CREAM CUPID HEARTS COAT HANGER</td>\n",
       "      <td>8</td>\n",
       "      <td>2010-12-01 08:26:00</td>\n",
       "      <td>2.75</td>\n",
       "      <td>17850.0</td>\n",
       "      <td>United Kingdom</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>536365</td>\n",
       "      <td>84029G</td>\n",
       "      <td>KNITTED UNION FLAG HOT WATER BOTTLE</td>\n",
       "      <td>6</td>\n",
       "      <td>2010-12-01 08:26:00</td>\n",
       "      <td>3.39</td>\n",
       "      <td>17850.0</td>\n",
       "      <td>United Kingdom</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>536365</td>\n",
       "      <td>84029E</td>\n",
       "      <td>RED WOOLLY HOTTIE WHITE HEART.</td>\n",
       "      <td>6</td>\n",
       "      <td>2010-12-01 08:26:00</td>\n",
       "      <td>3.39</td>\n",
       "      <td>17850.0</td>\n",
       "      <td>United Kingdom</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "  InvoiceNo StockCode                          Description  Quantity  \\\n",
       "0    536365    85123A   WHITE HANGING HEART T-LIGHT HOLDER         6   \n",
       "1    536365     71053                  WHITE METAL LANTERN         6   \n",
       "2    536365    84406B       CREAM CUPID HEARTS COAT HANGER         8   \n",
       "3    536365    84029G  KNITTED UNION FLAG HOT WATER BOTTLE         6   \n",
       "4    536365    84029E       RED WOOLLY HOTTIE WHITE HEART.         6   \n",
       "\n",
       "          InvoiceDate  UnitPrice  CustomerID         Country  \n",
       "0 2010-12-01 08:26:00       2.55     17850.0  United Kingdom  \n",
       "1 2010-12-01 08:26:00       3.39     17850.0  United Kingdom  \n",
       "2 2010-12-01 08:26:00       2.75     17850.0  United Kingdom  \n",
       "3 2010-12-01 08:26:00       3.39     17850.0  United Kingdom  \n",
       "4 2010-12-01 08:26:00       3.39     17850.0  United Kingdom  "
      ]
     },
     "execution_count": 23,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "data.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 24,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<matplotlib.axes._subplots.AxesSubplot at 0x1a1c730b00>"
      ]
     },
     "execution_count": 24,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "filtered_data.Country.value_counts()[:10].plot(kind='bar')\n",
    "\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Oberservation: Max customers originate from UK. We can hence choose to drop other nationalities."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Let's look at how many entires we have in UK and what data points exist on the customer."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 26,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "<class 'pandas.core.frame.DataFrame'>\n",
      "Int64Index: 61222 entries, 0 to 65534\n",
      "Data columns (total 8 columns):\n",
      "InvoiceNo      61222 non-null object\n",
      "StockCode      61222 non-null object\n",
      "Description    61056 non-null object\n",
      "Quantity       61222 non-null int64\n",
      "InvoiceDate    61222 non-null datetime64[ns]\n",
      "UnitPrice      61222 non-null float64\n",
      "CustomerID     35963 non-null float64\n",
      "Country        61222 non-null object\n",
      "dtypes: datetime64[ns](1), float64(2), int64(1), object(4)\n",
      "memory usage: 4.2+ MB\n"
     ]
    }
   ],
   "source": [
    "uk_data=data[data.Country=='United Kingdom']\n",
    "uk_data.info()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 27,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Quantity</th>\n",
       "      <th>UnitPrice</th>\n",
       "      <th>CustomerID</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>count</th>\n",
       "      <td>61222.000000</td>\n",
       "      <td>61222.000000</td>\n",
       "      <td>35963.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>mean</th>\n",
       "      <td>7.435954</td>\n",
       "      <td>6.002375</td>\n",
       "      <td>15662.166671</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>std</th>\n",
       "      <td>427.749894</td>\n",
       "      <td>150.725204</td>\n",
       "      <td>1622.541472</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>min</th>\n",
       "      <td>-74215.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>12346.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>25%</th>\n",
       "      <td>1.000000</td>\n",
       "      <td>1.250000</td>\n",
       "      <td>14415.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>50%</th>\n",
       "      <td>2.000000</td>\n",
       "      <td>2.510000</td>\n",
       "      <td>15581.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>75%</th>\n",
       "      <td>6.000000</td>\n",
       "      <td>4.250000</td>\n",
       "      <td>17211.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>max</th>\n",
       "      <td>74215.000000</td>\n",
       "      <td>16888.020000</td>\n",
       "      <td>18283.000000</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "           Quantity     UnitPrice    CustomerID\n",
       "count  61222.000000  61222.000000  35963.000000\n",
       "mean       7.435954      6.002375  15662.166671\n",
       "std      427.749894    150.725204   1622.541472\n",
       "min   -74215.000000      0.000000  12346.000000\n",
       "25%        1.000000      1.250000  14415.000000\n",
       "50%        2.000000      2.510000  15581.000000\n",
       "75%        6.000000      4.250000  17211.000000\n",
       "max    74215.000000  16888.020000  18283.000000"
      ]
     },
     "execution_count": 27,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "uk_data.describe()\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 28,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "<class 'pandas.core.frame.DataFrame'>\n",
      "Int64Index: 60187 entries, 0 to 65534\n",
      "Data columns (total 8 columns):\n",
      "InvoiceNo      60187 non-null object\n",
      "StockCode      60187 non-null object\n",
      "Description    60111 non-null object\n",
      "Quantity       60187 non-null int64\n",
      "InvoiceDate    60187 non-null datetime64[ns]\n",
      "UnitPrice      60187 non-null float64\n",
      "CustomerID     35089 non-null float64\n",
      "Country        60187 non-null object\n",
      "dtypes: datetime64[ns](1), float64(2), int64(1), object(4)\n",
      "memory usage: 4.1+ MB\n"
     ]
    }
   ],
   "source": [
    "uk_data = uk_data[(uk_data['Quantity']>0)]\n",
    "uk_data.info()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "For our analysis we need only a few data points. Let's take only these metrics and ignore the others. "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 30,
   "metadata": {},
   "outputs": [],
   "source": [
    "uk_data=uk_data[['CustomerID','InvoiceDate','InvoiceNo','Quantity','UnitPrice']]\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Calulating Net. Purchase Value - Rev as some would consider it. "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 31,
   "metadata": {},
   "outputs": [],
   "source": [
    "uk_data['TotalPurchase'] = uk_data['Quantity'] * uk_data['UnitPrice']\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Following meterics are imp for us. \n",
    "\n",
    "Time elapsed from the time of last purchase\n",
    "No. of orders per customer\n",
    "Total value of purchases made by customer\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 32,
   "metadata": {},
   "outputs": [],
   "source": [
    "uk_data_group=uk_data.groupby('CustomerID').agg({'InvoiceDate': lambda date: (date.max() - date.min()).days,\n",
    "                                        'InvoiceNo': lambda num: len(num),\n",
    "                                        'Quantity': lambda quant: quant.sum(),\n",
    "                                        'TotalPurchase': lambda price: price.sum()})"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 33,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>InvoiceDate</th>\n",
       "      <th>InvoiceNo</th>\n",
       "      <th>Quantity</th>\n",
       "      <th>TotalPurchase</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CustomerID</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>12346.0</th>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>74215</td>\n",
       "      <td>77183.60</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12747.0</th>\n",
       "      <td>45</td>\n",
       "      <td>20</td>\n",
       "      <td>301</td>\n",
       "      <td>1009.31</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12748.0</th>\n",
       "      <td>47</td>\n",
       "      <td>693</td>\n",
       "      <td>2973</td>\n",
       "      <td>4646.90</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12820.0</th>\n",
       "      <td>0</td>\n",
       "      <td>11</td>\n",
       "      <td>146</td>\n",
       "      <td>170.46</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12826.0</th>\n",
       "      <td>40</td>\n",
       "      <td>25</td>\n",
       "      <td>346</td>\n",
       "      <td>367.72</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "            InvoiceDate  InvoiceNo  Quantity  TotalPurchase\n",
       "CustomerID                                                 \n",
       "12346.0               0          1     74215       77183.60\n",
       "12747.0              45         20       301        1009.31\n",
       "12748.0              47        693      2973        4646.90\n",
       "12820.0               0         11       146         170.46\n",
       "12826.0              40         25       346         367.72"
      ]
     },
     "execution_count": 33,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "uk_data_group.head()\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Adjusting coloumn names for ease."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 34,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>num_days</th>\n",
       "      <th>num_transactions</th>\n",
       "      <th>num_units</th>\n",
       "      <th>spent_money</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CustomerID</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>12346.0</th>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>74215</td>\n",
       "      <td>77183.60</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12747.0</th>\n",
       "      <td>45</td>\n",
       "      <td>20</td>\n",
       "      <td>301</td>\n",
       "      <td>1009.31</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12748.0</th>\n",
       "      <td>47</td>\n",
       "      <td>693</td>\n",
       "      <td>2973</td>\n",
       "      <td>4646.90</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12820.0</th>\n",
       "      <td>0</td>\n",
       "      <td>11</td>\n",
       "      <td>146</td>\n",
       "      <td>170.46</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12826.0</th>\n",
       "      <td>40</td>\n",
       "      <td>25</td>\n",
       "      <td>346</td>\n",
       "      <td>367.72</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "            num_days  num_transactions  num_units  spent_money\n",
       "CustomerID                                                    \n",
       "12346.0            0                 1      74215     77183.60\n",
       "12747.0           45                20        301      1009.31\n",
       "12748.0           47               693       2973      4646.90\n",
       "12820.0            0                11        146       170.46\n",
       "12826.0           40                25        346       367.72"
      ]
     },
     "execution_count": 34,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "uk_data_group.columns=['num_days','num_transactions','num_units','spent_money']\n",
    "uk_data_group.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Calculate the following\n",
    "\n",
    "CLTV = ((Average Order Value x Purchase Frequency)/Churn Rate) x Profit margin.\n",
    "\n",
    "Customer Value = Average Order Value * Purchase Frequency"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 36,
   "metadata": {},
   "outputs": [],
   "source": [
    "uk_data_group['avg_order_value']=uk_data_group['spent_money']/uk_data_group['num_transactions']\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 37,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>num_days</th>\n",
       "      <th>num_transactions</th>\n",
       "      <th>num_units</th>\n",
       "      <th>spent_money</th>\n",
       "      <th>avg_order_value</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CustomerID</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>12346.0</th>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>74215</td>\n",
       "      <td>77183.60</td>\n",
       "      <td>77183.600000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12747.0</th>\n",
       "      <td>45</td>\n",
       "      <td>20</td>\n",
       "      <td>301</td>\n",
       "      <td>1009.31</td>\n",
       "      <td>50.465500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12748.0</th>\n",
       "      <td>47</td>\n",
       "      <td>693</td>\n",
       "      <td>2973</td>\n",
       "      <td>4646.90</td>\n",
       "      <td>6.705483</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12820.0</th>\n",
       "      <td>0</td>\n",
       "      <td>11</td>\n",
       "      <td>146</td>\n",
       "      <td>170.46</td>\n",
       "      <td>15.496364</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12826.0</th>\n",
       "      <td>40</td>\n",
       "      <td>25</td>\n",
       "      <td>346</td>\n",
       "      <td>367.72</td>\n",
       "      <td>14.708800</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "            num_days  num_transactions  num_units  spent_money  \\\n",
       "CustomerID                                                       \n",
       "12346.0            0                 1      74215     77183.60   \n",
       "12747.0           45                20        301      1009.31   \n",
       "12748.0           47               693       2973      4646.90   \n",
       "12820.0            0                11        146       170.46   \n",
       "12826.0           40                25        346       367.72   \n",
       "\n",
       "            avg_order_value  \n",
       "CustomerID                   \n",
       "12346.0        77183.600000  \n",
       "12747.0           50.465500  \n",
       "12748.0            6.705483  \n",
       "12820.0           15.496364  \n",
       "12826.0           14.708800  "
      ]
     },
     "execution_count": 37,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "uk_data_group.head()\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Cal. Purchase Frequency, Repeat Rate, Churn Rate and Profit Margin."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 38,
   "metadata": {},
   "outputs": [],
   "source": [
    "purchase_frequency=sum(uk_data_group['num_transactions'])/uk_data_group.shape[0]\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 39,
   "metadata": {},
   "outputs": [],
   "source": [
    "repeat_rate=uk_data_group[uk_data_group.num_transactions > 1].shape[0]/uk_data_group.shape[0]\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 40,
   "metadata": {},
   "outputs": [],
   "source": [
    "churn_rate=1-repeat_rate\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 41,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(34.100097181729836, 0.9650145772594753, 0.03498542274052474)"
      ]
     },
     "execution_count": 41,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "purchase_frequency,repeat_rate,churn_rate\n"
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {},
   "source": [
    "Profit Margin is Revenue - All operational expenese (Also termed as Net. Gains)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 62,
   "metadata": {},
   "outputs": [],
   "source": [
    "uk_data_group['profit_margin']=uk_data_group['spent_money']*0.05\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 43,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>num_days</th>\n",
       "      <th>num_transactions</th>\n",
       "      <th>num_units</th>\n",
       "      <th>spent_money</th>\n",
       "      <th>avg_order_value</th>\n",
       "      <th>profit_margin</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CustomerID</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>12346.0</th>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>74215</td>\n",
       "      <td>77183.60</td>\n",
       "      <td>77183.600000</td>\n",
       "      <td>3859.1800</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12747.0</th>\n",
       "      <td>45</td>\n",
       "      <td>20</td>\n",
       "      <td>301</td>\n",
       "      <td>1009.31</td>\n",
       "      <td>50.465500</td>\n",
       "      <td>50.4655</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12748.0</th>\n",
       "      <td>47</td>\n",
       "      <td>693</td>\n",
       "      <td>2973</td>\n",
       "      <td>4646.90</td>\n",
       "      <td>6.705483</td>\n",
       "      <td>232.3450</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12820.0</th>\n",
       "      <td>0</td>\n",
       "      <td>11</td>\n",
       "      <td>146</td>\n",
       "      <td>170.46</td>\n",
       "      <td>15.496364</td>\n",
       "      <td>8.5230</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12826.0</th>\n",
       "      <td>40</td>\n",
       "      <td>25</td>\n",
       "      <td>346</td>\n",
       "      <td>367.72</td>\n",
       "      <td>14.708800</td>\n",
       "      <td>18.3860</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "            num_days  num_transactions  num_units  spent_money  \\\n",
       "CustomerID                                                       \n",
       "12346.0            0                 1      74215     77183.60   \n",
       "12747.0           45                20        301      1009.31   \n",
       "12748.0           47               693       2973      4646.90   \n",
       "12820.0            0                11        146       170.46   \n",
       "12826.0           40                25        346       367.72   \n",
       "\n",
       "            avg_order_value  profit_margin  \n",
       "CustomerID                                  \n",
       "12346.0        77183.600000      3859.1800  \n",
       "12747.0           50.465500        50.4655  \n",
       "12748.0            6.705483       232.3450  \n",
       "12820.0           15.496364         8.5230  \n",
       "12826.0           14.708800        18.3860  "
      ]
     },
     "execution_count": 43,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "uk_data_group.head()\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Now we are ready to calculate CLV"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 44,
   "metadata": {},
   "outputs": [],
   "source": [
    "uk_data_group['CLV']=(uk_data_group['avg_order_value']*purchase_frequency)/churn_rate\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 45,
   "metadata": {},
   "outputs": [],
   "source": [
    "uk_data_group['cust_lifetime_value']=uk_data_group['CLV']*uk_data_group['profit_margin']\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 46,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>num_days</th>\n",
       "      <th>num_transactions</th>\n",
       "      <th>num_units</th>\n",
       "      <th>spent_money</th>\n",
       "      <th>avg_order_value</th>\n",
       "      <th>profit_margin</th>\n",
       "      <th>CLV</th>\n",
       "      <th>cust_lifetime_value</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CustomerID</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>12346.0</th>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>74215</td>\n",
       "      <td>77183.60</td>\n",
       "      <td>77183.600000</td>\n",
       "      <td>3859.1800</td>\n",
       "      <td>7.523043e+07</td>\n",
       "      <td>2.903278e+11</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12747.0</th>\n",
       "      <td>45</td>\n",
       "      <td>20</td>\n",
       "      <td>301</td>\n",
       "      <td>1009.31</td>\n",
       "      <td>50.465500</td>\n",
       "      <td>50.4655</td>\n",
       "      <td>4.918844e+04</td>\n",
       "      <td>2.482319e+06</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12748.0</th>\n",
       "      <td>47</td>\n",
       "      <td>693</td>\n",
       "      <td>2973</td>\n",
       "      <td>4646.90</td>\n",
       "      <td>6.705483</td>\n",
       "      <td>232.3450</td>\n",
       "      <td>6.535797e+03</td>\n",
       "      <td>1.518560e+06</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12820.0</th>\n",
       "      <td>0</td>\n",
       "      <td>11</td>\n",
       "      <td>146</td>\n",
       "      <td>170.46</td>\n",
       "      <td>15.496364</td>\n",
       "      <td>8.5230</td>\n",
       "      <td>1.510422e+04</td>\n",
       "      <td>1.287333e+05</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12826.0</th>\n",
       "      <td>40</td>\n",
       "      <td>25</td>\n",
       "      <td>346</td>\n",
       "      <td>367.72</td>\n",
       "      <td>14.708800</td>\n",
       "      <td>18.3860</td>\n",
       "      <td>1.433659e+04</td>\n",
       "      <td>2.635925e+05</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "            num_days  num_transactions  num_units  spent_money  \\\n",
       "CustomerID                                                       \n",
       "12346.0            0                 1      74215     77183.60   \n",
       "12747.0           45                20        301      1009.31   \n",
       "12748.0           47               693       2973      4646.90   \n",
       "12820.0            0                11        146       170.46   \n",
       "12826.0           40                25        346       367.72   \n",
       "\n",
       "            avg_order_value  profit_margin           CLV  cust_lifetime_value  \n",
       "CustomerID                                                                     \n",
       "12346.0        77183.600000      3859.1800  7.523043e+07         2.903278e+11  \n",
       "12747.0           50.465500        50.4655  4.918844e+04         2.482319e+06  \n",
       "12748.0            6.705483       232.3450  6.535797e+03         1.518560e+06  \n",
       "12820.0           15.496364         8.5230  1.510422e+04         1.287333e+05  \n",
       "12826.0           14.708800        18.3860  1.433659e+04         2.635925e+05  "
      ]
     },
     "execution_count": 46,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "uk_data_group.head()\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Now let's start building a model for generating predictions. \n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 47,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>CustomerID</th>\n",
       "      <th>InvoiceDate</th>\n",
       "      <th>InvoiceNo</th>\n",
       "      <th>Quantity</th>\n",
       "      <th>UnitPrice</th>\n",
       "      <th>TotalPurchase</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>17850.0</td>\n",
       "      <td>2010-12-01 08:26:00</td>\n",
       "      <td>536365</td>\n",
       "      <td>6</td>\n",
       "      <td>2.55</td>\n",
       "      <td>15.30</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>17850.0</td>\n",
       "      <td>2010-12-01 08:26:00</td>\n",
       "      <td>536365</td>\n",
       "      <td>6</td>\n",
       "      <td>3.39</td>\n",
       "      <td>20.34</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>17850.0</td>\n",
       "      <td>2010-12-01 08:26:00</td>\n",
       "      <td>536365</td>\n",
       "      <td>8</td>\n",
       "      <td>2.75</td>\n",
       "      <td>22.00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>17850.0</td>\n",
       "      <td>2010-12-01 08:26:00</td>\n",
       "      <td>536365</td>\n",
       "      <td>6</td>\n",
       "      <td>3.39</td>\n",
       "      <td>20.34</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>17850.0</td>\n",
       "      <td>2010-12-01 08:26:00</td>\n",
       "      <td>536365</td>\n",
       "      <td>6</td>\n",
       "      <td>3.39</td>\n",
       "      <td>20.34</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   CustomerID         InvoiceDate InvoiceNo  Quantity  UnitPrice  \\\n",
       "0     17850.0 2010-12-01 08:26:00    536365         6       2.55   \n",
       "1     17850.0 2010-12-01 08:26:00    536365         6       3.39   \n",
       "2     17850.0 2010-12-01 08:26:00    536365         8       2.75   \n",
       "3     17850.0 2010-12-01 08:26:00    536365         6       3.39   \n",
       "4     17850.0 2010-12-01 08:26:00    536365         6       3.39   \n",
       "\n",
       "   TotalPurchase  \n",
       "0          15.30  \n",
       "1          20.34  \n",
       "2          22.00  \n",
       "3          20.34  \n",
       "4          20.34  "
      ]
     },
     "execution_count": 47,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "uk_data.head()\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Since now we have obtained the CLTV for customers. \n",
    "Let's focus on building a model that can predict the same. \n",
    "\n",
    "For this\n",
    "We need month and year from invoice data."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 48,
   "metadata": {},
   "outputs": [],
   "source": [
    "uk_data['month_yr'] = uk_data['InvoiceDate'].apply(lambda x: x.strftime('%b-%Y'))\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 49,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>CustomerID</th>\n",
       "      <th>InvoiceDate</th>\n",
       "      <th>InvoiceNo</th>\n",
       "      <th>Quantity</th>\n",
       "      <th>UnitPrice</th>\n",
       "      <th>TotalPurchase</th>\n",
       "      <th>month_yr</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>17850.0</td>\n",
       "      <td>2010-12-01 08:26:00</td>\n",
       "      <td>536365</td>\n",
       "      <td>6</td>\n",
       "      <td>2.55</td>\n",
       "      <td>15.30</td>\n",
       "      <td>Dec-2010</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>17850.0</td>\n",
       "      <td>2010-12-01 08:26:00</td>\n",
       "      <td>536365</td>\n",
       "      <td>6</td>\n",
       "      <td>3.39</td>\n",
       "      <td>20.34</td>\n",
       "      <td>Dec-2010</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>17850.0</td>\n",
       "      <td>2010-12-01 08:26:00</td>\n",
       "      <td>536365</td>\n",
       "      <td>8</td>\n",
       "      <td>2.75</td>\n",
       "      <td>22.00</td>\n",
       "      <td>Dec-2010</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>17850.0</td>\n",
       "      <td>2010-12-01 08:26:00</td>\n",
       "      <td>536365</td>\n",
       "      <td>6</td>\n",
       "      <td>3.39</td>\n",
       "      <td>20.34</td>\n",
       "      <td>Dec-2010</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>17850.0</td>\n",
       "      <td>2010-12-01 08:26:00</td>\n",
       "      <td>536365</td>\n",
       "      <td>6</td>\n",
       "      <td>3.39</td>\n",
       "      <td>20.34</td>\n",
       "      <td>Dec-2010</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   CustomerID         InvoiceDate InvoiceNo  Quantity  UnitPrice  \\\n",
       "0     17850.0 2010-12-01 08:26:00    536365         6       2.55   \n",
       "1     17850.0 2010-12-01 08:26:00    536365         6       3.39   \n",
       "2     17850.0 2010-12-01 08:26:00    536365         8       2.75   \n",
       "3     17850.0 2010-12-01 08:26:00    536365         6       3.39   \n",
       "4     17850.0 2010-12-01 08:26:00    536365         6       3.39   \n",
       "\n",
       "   TotalPurchase  month_yr  \n",
       "0          15.30  Dec-2010  \n",
       "1          20.34  Dec-2010  \n",
       "2          22.00  Dec-2010  \n",
       "3          20.34  Dec-2010  \n",
       "4          20.34  Dec-2010  "
      ]
     },
     "execution_count": 49,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "uk_data.head()\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 50,
   "metadata": {},
   "outputs": [],
   "source": [
    "sale=uk_data.pivot_table(index=['CustomerID'],columns=['month_yr'],values='TotalPurchase',aggfunc='sum',fill_value=0).reset_index()\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 51,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th>month_yr</th>\n",
       "      <th>CustomerID</th>\n",
       "      <th>Dec-2010</th>\n",
       "      <th>Jan-2011</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>12346.0</td>\n",
       "      <td>0.00</td>\n",
       "      <td>77183.60</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>12747.0</td>\n",
       "      <td>706.27</td>\n",
       "      <td>303.04</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>12748.0</td>\n",
       "      <td>4228.13</td>\n",
       "      <td>418.77</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>12820.0</td>\n",
       "      <td>0.00</td>\n",
       "      <td>170.46</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>12826.0</td>\n",
       "      <td>155.00</td>\n",
       "      <td>212.72</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "month_yr  CustomerID  Dec-2010  Jan-2011\n",
       "0            12346.0      0.00  77183.60\n",
       "1            12747.0    706.27    303.04\n",
       "2            12748.0   4228.13    418.77\n",
       "3            12820.0      0.00    170.46\n",
       "4            12826.0    155.00    212.72"
      ]
     },
     "execution_count": 51,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "sale.head()\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Below we are getting total monthyl sales by sum."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 52,
   "metadata": {},
   "outputs": [],
   "source": [
    "sale['CLV']=sale.iloc[:,2:].sum(axis=1)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 53,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th>month_yr</th>\n",
       "      <th>CustomerID</th>\n",
       "      <th>Dec-2010</th>\n",
       "      <th>Jan-2011</th>\n",
       "      <th>CLV</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>12346.0</td>\n",
       "      <td>0.00</td>\n",
       "      <td>77183.60</td>\n",
       "      <td>77183.60</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>12747.0</td>\n",
       "      <td>706.27</td>\n",
       "      <td>303.04</td>\n",
       "      <td>303.04</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>12748.0</td>\n",
       "      <td>4228.13</td>\n",
       "      <td>418.77</td>\n",
       "      <td>418.77</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>12820.0</td>\n",
       "      <td>0.00</td>\n",
       "      <td>170.46</td>\n",
       "      <td>170.46</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>12826.0</td>\n",
       "      <td>155.00</td>\n",
       "      <td>212.72</td>\n",
       "      <td>212.72</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "month_yr  CustomerID  Dec-2010  Jan-2011       CLV\n",
       "0            12346.0      0.00  77183.60  77183.60\n",
       "1            12747.0    706.27    303.04    303.04\n",
       "2            12748.0   4228.13    418.77    418.77\n",
       "3            12820.0      0.00    170.46    170.46\n",
       "4            12826.0    155.00    212.72    212.72"
      ]
     },
     "execution_count": 53,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "sale.head()\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Now, let's select features and targets. "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 55,
   "metadata": {},
   "outputs": [],
   "source": [
    "X=sale[['Dec-2010','Jan-2011']]\n",
    "y=sale[['CLV']]"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "We now split data into train and test, we are not adding validation set as we have less data."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 57,
   "metadata": {},
   "outputs": [],
   "source": [
    "from sklearn.model_selection import train_test_split\n",
    "X_train, X_test, y_train, y_test = train_test_split(X, y,random_state=0)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Now we define instantiate and define our model and pass relevant sets to it. "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 58,
   "metadata": {},
   "outputs": [],
   "source": [
    "from sklearn.linear_model import LinearRegression\n",
    "\n",
    "# instantiate\n",
    "linreg = LinearRegression()\n",
    "\n",
    "# fit the model to the training data (learn the coefficients)\n",
    "linreg.fit(X_train, y_train)\n",
    "\n",
    "# make predictions on the testing set\n",
    "y_pred = linreg.predict(X_test)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 59,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[-5.68434189e-14]\n",
      "[[-1.6852649e-17  1.0000000e+00]]\n"
     ]
    }
   ],
   "source": [
    "print(linreg.intercept_)\n",
    "print(linreg.coef_)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Now we want to see how the model fits the data. "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 60,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "R-Square: 1.0\n"
     ]
    }
   ],
   "source": [
    "from sklearn import metrics\n",
    "\n",
    "# compute the R Square for model\n",
    "print(\"R-Square:\",metrics.r2_score(y_test, y_pred))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 61,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "MAE: 8.180279243083631e-14\n",
      "MSE 6.684535527022872e-26\n",
      "RMSE: 2.5854468718236836e-13\n"
     ]
    }
   ],
   "source": [
    "# calculate MAE using scikit-learn\n",
    "print(\"MAE:\",metrics.mean_absolute_error(y_test,y_pred))\n",
    "\n",
    "#calculate mean squared error\n",
    "print(\"MSE\",metrics.mean_squared_error(y_test, y_pred))\n",
    "# compute the RMSE of our predictions\n",
    "print(\"RMSE:\",np.sqrt(metrics.mean_squared_error(y_test, y_pred)))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.3"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
